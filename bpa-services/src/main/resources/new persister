serviceMaps:
 serviceName: bpa-services
 mappings:
 - version: 1.0
   description: Persists buildingplan details in EG_BPA_BuildingPlan  table
   fromTopic: save-bpa-buildingplan
   isTransaction: true
   queryMaps:

       - query: INSERT INTO eg_bpa_buildingplan(id, applicationNo, approvalNo, accountId, edcrNumber, tenantId, status, action, assignes, comments, additionalDetails, createdBy, lastmodifiedBy, createdTime, lastmodifiedTime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?); 
         basePath: BPA
         jsonMaps:
          - jsonPath: $.BPA.id

          - jsonPath: $.BPA.applicationNo
          
          - jsonPath: $.BPA.approvalNo
          
          - jsonPath: $.BPA.accountId

          - jsonPath: $.BPA.edcrNumber
          
          - jsonPath: $.BPA.tenantId
          
          - jsonPath: $.BPA.status
          
          - jsonPath: $.BPA.workflow.action

          - jsonPath: $.BPA.workflow.assignes

          - jsonPath: $.BPA.workflow.comments

          - jsonPath: $.BPA.additionalDetails
            type: JSON
            dbType: JSONB

          - jsonPath: $.BPA.auditDetails.createdBy

          - jsonPath: $.BPA.auditDetails.lastModifiedBy

          - jsonPath: $.BPA.auditDetails.createdTime

          - jsonPath: $.BPA.auditDetails.lastModifiedTime


       - query: INSERT INTO eg_bpa_document( id, documenttype, filestore, buildingplanid, documentuid, additionalDetails, createdby, lastmodifiedby, createdtime, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
         basePath: BPA.documents.*
         jsonMaps:
          - jsonPath: $.BPA.documents.*.id

          - jsonPath: $.BPA.documents.*.documentType

          - jsonPath: $.BPA.documents.*.fileStore

          - jsonPath: $.BPA.id

          - jsonPath: $.BPA.documents.*.documentUid

          - jsonPath: $.BPA.additionalDetails
            type: JSON
            dbType: JSONB

          - jsonPath: $.BPA.auditDetails.createdBy

          - jsonPath: $.BPA.auditDetails.lastModifiedBy

          - jsonPath: $.BPA.auditDetails.createdTime

          - jsonPath: $.BPA.auditDetails.lastModifiedTime



       - query: INSERT INTO eg_bpa_auditdetails SELECT * FROM eg_bpa_buildingplan WHERE id =?;
         basePath: BPA
         jsonMaps:

          - jsonPath: $.BPA.id
  



 - version: 1.0
   description: update buildingplan details in EG_BPA_BuildingPlan  table
   fromTopic: update-bpa-buildingplan
   isTransaction: true
   queryMaps:

       - query: UPDATE eg_bpa_buildingplan SET applicationno=?, approvalNo=?, riskType=?, status=?, additionaldetails=?, lastmodifiedby=?, lastmodifiedtime=?, validityDate=?, orderGeneratedDate=? WHERE id=?;
         basePath: BPA
         jsonMaps:
          - jsonPath: $.BPA.applicationNo
          
          - jsonPath: $.BPA.approvalNo

          - jsonPath: $.BPA.riskType

          - jsonPath: $.BPA.status

          - jsonPath: $.BPA.additionalDetails
            type: JSON
            dbType: JSONB

          - jsonPath: $.BPA.auditDetails.lastModifiedBy

          - jsonPath: $.BPA.auditDetails.lastModifiedTime

          - jsonPath: $.BPA.validityDate

          - jsonPath: $.BPA.orderGeneratedDate

          - jsonPath: $.BPA.id


       - query: INSERT INTO eg_bpa_auditdetails SELECT * FROM eg_bpa_buildingplan WHERE id =?;
         basePath: BPA
         jsonMaps:

           - jsonPath: $.BPA.id

        
       - query: INSERT INTO eg_bpa_document(id, documenttype, filestore, buildingplanid, documentuid, additionalDetails, createdby, lastmodifiedby, createdtime, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (id) DO UPDATE SET documenttype =?,  filestore =?, additionalDetails=?, lastmodifiedby =?, lastmodifiedtime =?;
         basePath: BPA.documents.*
         jsonMaps:
          
           - jsonPath: $.BPA.documents.*.id
  
           - jsonPath: $.BPA.documents.*.documentType
  
           - jsonPath: $.BPA.documents.*.fileStore
  
           - jsonPath: $.BPA.id
  
           - jsonPath: $.BPA.documents.*.documentuid
  
           - jsonPath: $.BPA.documents.*.additionalDetails
  
           - jsonPath: $.BPA.auditDetails.createdBy
  
           - jsonPath: $.BPA.auditDetails.lastModifiedBy
  
           - jsonPath: $.BPA.auditDetails.createdTime

           - jsonPath: $.BPA.auditDetails.lastModifiedTime
           
           - jsonPath: $.BPA.documents.*.wfState

           - jsonPath: $.BPA.documents.*.documentType

           - jsonPath: $.BPA.documents.*.fileStore
  
           - jsonPath: $.BPA.documents.*.additionalDetails

           - jsonPath: $.BPA.auditDetails.lastModifiedBy

           - jsonPath: $.BPA.auditDetails.lastModifiedTime
          
 - version: 1.0
   description: update buildingplan details in EG_BPA_BuildingPlan  table
   fromTopic: update-bpa-workflow
   isTransaction: true
   queryMaps:
   
          
       - query: INSERT INTO eg_bpa_document(id, documenttype, filestore, buildingplanid, documentuid, additionalDetails, createdby, lastmodifiedby, createdtime, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (id) DO UPDATE SET documenttype =?,  filestore =?, additionalDetails=?, lastmodifiedby =?, lastmodifiedtime =?;
         basePath: BPA.documents.*
         jsonMaps:
          
           - jsonPath: $.BPA.documents.*.id
  
           - jsonPath: $.BPA.documents.*.documentType
  
           - jsonPath: $.BPA.documents.*.fileStore
  
           - jsonPath: $.BPA.id
  
           - jsonPath: $.BPA.documents.*.documentuid
  
           - jsonPath: $.BPA.documents.*.additionalDetails
  
           - jsonPath: $.BPA.auditDetails.createdBy
  
           - jsonPath: $.BPA.auditDetails.lastModifiedBy
  
           - jsonPath: $.BPA.auditDetails.createdTime

           - jsonPath: $.BPA.auditDetails.lastModifiedTime
           
           - jsonPath: $.BPA.documents.*.wfState

           - jsonPath: $.BPA.documents.*.documentType

           - jsonPath: $.BPA.documents.*.fileStore
  
           - jsonPath: $.BPA.documents.*.additionalDetails

           - jsonPath: $.BPA.auditDetails.lastModifiedBy

           - jsonPath: $.BPA.auditDetails.lastModifiedTime
           
           
       - query: INSERT INTO eg_bpa_auditdetails SELECT * FROM eg_bpa_buildingplan WHERE id =?;
         basePath: BPA
         jsonMaps:

           - jsonPath: $.BPA.id

       - query: UPDATE eg_bpa_buildingplan SET status =?, approvalNo=?, additionaldetails=?  WHERE id =?;
         basePath: BPA
         jsonMaps:
           - jsonPath: $.BPA.status
           
           - jsonPath: $.BPA.approvalNo
           
           - jsonPath: $.BPA.additionalDetails
             type: JSON
             dbType: JSONB
              
           - jsonPath: $.BPA.id

